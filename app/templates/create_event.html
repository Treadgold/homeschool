{% extends "base.html" %}
{% block title %}Admin – Create Event{% endblock %}
{% block extra_head %}
<style>
/* Multi-step wizard styles */
.wizard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.wizard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    border-radius: 10px;
    color: white;
}

.step-indicator {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
}

.step {
    display: flex;
    align-items: center;
    margin: 0 10px;
    padding: 10px 20px;
    border-radius: 25px;
    background: #f0f0f0;
    color: #666;
    transition: all 0.3s ease;
}

.step.active {
    background: #667eea;
    color: white;
    transform: scale(1.05);
}

.step.completed {
    background: #28a745;
    color: white;
}

.step-number {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
    font-weight: bold;
}

.wizard-content {
    display: flex;
    gap: 30px;
}

.form-section {
    flex: 2;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    min-height: 600px;
}

.preview-section {
    flex: 1;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    position: sticky;
    top: 20px;
    height: fit-content;
}

.step-content {
    display: none;
}

.step-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-grid.single {
    grid-template-columns: 1fr;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.wizard-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e1e5e9;
}

#submit-section {
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
}

.submit-buttons {
    display: flex;
    gap: 10px;
}

.draft-help {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
    text-align: right;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-primary:hover {
    background: #5a6fd8;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.ticket-types {
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.ticket-type {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: #f8f9fa;
}

.media-upload {
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
    transition: all 0.3s ease;
}

.media-upload:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.event-preview {
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #f8f9fa;
}

.preview-title {
    font-size: 24px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
}

.preview-meta {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
}

.preview-image {
    width: 100%;
    max-height: 200px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 15px;
}

/* Progress bar */
.progress-bar {
    width: 100%;
    height: 6px;
    background: #e1e5e9;
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 20px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transition: width 0.3s ease;
}

/* Validation Error Styles */
.validation-errors {
    background: #fee;
    border: 2px solid #dc3545;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    animation: slideDown 0.3s ease-out;
}

.error-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: #dc3545;
    margin-bottom: 10px;
}

.error-icon {
    font-size: 18px;
}

.error-list {
    margin: 0;
    padding-left: 20px;
    color: #721c24;
}

.error-list li {
    margin-bottom: 5px;
}

.error-field {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    background-color: #fff5f5 !important;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Required Field Indicators */
label[for]:after {
    content: "";
}

/* Mark required fields with asterisk */
label[for="title"]:after,
label[for="event_type"]:after,
label[for="short_description"]:after,
label[for="start_date"]:after,
label[for="event_format"]:after {
    content: " *";
    color: #dc3545;
    font-weight: bold;
}

/* Enhance form field styling */
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: #4299e1;
    box-shadow: 0 0 0 0.2rem rgba(66, 153, 225, 0.25);
    outline: none;
}

.form-group input[type="checkbox"]:focus {
    box-shadow: 0 0 0 0.2rem rgba(66, 153, 225, 0.25);
}

/* Success states */
.form-group input.valid,
.form-group select.valid,
.form-group textarea.valid {
    border-color: #28a745;
    background-color: #f8fff9;
}

/* Help text styling */
.field-help {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
    font-style: italic;
}

/* Discount field styling */
.discount-group {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    margin: 15px 0;
}

.discount-group h4 {
    margin: 0 0 10px 0;
    color: #495057;
    font-size: 14px;
    font-weight: 600;
}
</style>
{% endblock %}

{% block content %}
<div class="wizard-container">
    <!-- Wizard Header -->
    <div class="wizard-header">
        <div>
            <h1>Create New Event</h1>
            <p>Build comprehensive events with our step-by-step wizard</p>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="step active" data-step="1">
            <span class="step-number">1</span>
            <span>Basic Info</span>
        </div>
        <div class="step" data-step="2">
            <span class="step-number">2</span>
            <span>Details & Location</span>
        </div>
        <div class="step" data-step="3">
            <span class="step-number">3</span>
            <span>Media & Content</span>
        </div>
        <div class="step" data-step="4">
            <span class="step-number">4</span>
            <span>Ticketing</span>
        </div>
        <div class="step" data-step="5">
            <span class="step-number">5</span>
            <span>Links & Publish</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="wizard-content">
        <!-- Form Section -->
        <div class="form-section">
            <form method="post" id="event-form" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                
                <!-- Step 1: Basic Information -->
                <div class="step-content active" id="step-1">
                    <h2>Basic Event Information</h2>
                    <p>Let's start with the essential details about your event.</p>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="title">Event Title *</label>
                            <input type="text" name="title" id="title" required placeholder="Enter event title">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="event_type">Event Type *</label>
                            <select name="event_type" id="event_type" required>
                                <option value="">Select event type</option>
                                <option value="educational_trip">Educational Trip</option>
                                <option value="workshop">Workshop/Class</option>
                                <option value="sport_event">Sports Event</option>
                                <option value="social_event">Social Event</option>
                                <option value="online_event">Online Event</option>
                                <option value="conference">Conference</option>
                                <option value="fundraiser">Fundraiser</option>
                                <option value="performance">Performance</option>
                                <option value="competition">Competition</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Event Status</label>
                            <select name="status" id="status">
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="subtitle">Event Subtitle</label>
                            <input type="text" name="subtitle" id="subtitle" placeholder="Brief subtitle or tagline">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="short_description">Short Description *</label>
                            <textarea name="short_description" id="short_description" required placeholder="Brief description for event cards and previews (max 200 characters)" maxlength="200"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="description">Full Description</label>
                            <textarea name="description" id="description" placeholder="Detailed event description"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="start_date">Start Date & Time *</label>
                            <input type="datetime-local" name="start_date" id="start_date" required>
                        </div>
                        <div class="form-group">
                            <label for="end_date">End Date & Time</label>
                            <input type="datetime-local" name="end_date" id="end_date">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="timezone">Timezone</label>
                            <select name="timezone" id="timezone">
                                <option value="Pacific/Auckland" selected>Auckland (NZST/NZDT)</option>
                                <option value="Pacific/Chatham">Chatham Islands</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="is_recurring" id="is_recurring">
                                <label for="is_recurring">Recurring Event</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Details & Location -->
                <div class="step-content" id="step-2">
                    <h2>Event Details & Location</h2>
                    <p>Specify location, requirements, and event details.</p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="event_format">Event Format *</label>
                            <select name="event_format" id="event_format" required>
                                <option value="">Select format</option>
                                <option value="in_person">In-Person</option>
                                <option value="online">Online</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="max_participants">Max Participants</label>
                            <input type="number" name="max_participants" id="max_participants" min="1" placeholder="e.g. 50">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="min_age">Minimum Age</label>
                            <input type="number" name="min_age" id="min_age" min="0" placeholder="e.g. 5">
                        </div>
                        <div class="form-group">
                            <label for="max_age">Maximum Age</label>
                            <input type="number" name="max_age" id="max_age" min="0" placeholder="e.g. 18">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="venue_name">Venue Name</label>
                            <input type="text" name="venue_name" id="venue_name" placeholder="e.g. Central Zoo, Main Hall">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="address">Address</label>
                            <input type="text" name="address" id="address" placeholder="Street address">
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" name="city" id="city" placeholder="City">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="state">Region</label>
                            <select name="state" id="state">
                                <option value="">Select region</option>
                                <option value="Auckland">Auckland</option>
                                <option value="Bay of Plenty">Bay of Plenty</option>
                                <option value="Canterbury">Canterbury</option>
                                <option value="Gisborne">Gisborne</option>
                                <option value="Hawke's Bay">Hawke's Bay</option>
                                <option value="Manawatu-Wanganui">Manawatu-Wanganui</option>
                                <option value="Marlborough">Marlborough</option>
                                <option value="Nelson">Nelson</option>
                                <option value="Northland">Northland</option>
                                <option value="Otago">Otago</option>
                                <option value="Southland">Southland</option>
                                <option value="Taranaki">Taranaki</option>
                                <option value="Tasman">Tasman</option>
                                <option value="Waikato">Waikato</option>
                                <option value="Wellington">Wellington</option>
                                <option value="West Coast">West Coast</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="zip_code">Postcode</label>
                            <input type="text" name="zip_code" id="zip_code" placeholder="e.g. 1010" maxlength="4" pattern="[0-9]{4}">
                            <div class="field-help">4-digit NZ postcode</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="country">Country</label>
                            <input type="text" name="country" id="country" value="New Zealand" readonly>
                        </div>
                        <div class="form-group">
                            <label for="venue_capacity">Venue Capacity</label>
                            <input type="number" name="venue_capacity" id="venue_capacity" placeholder="Total venue capacity">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="online_meeting_link">Online Meeting Link</label>
                            <input type="url" name="online_meeting_link" id="online_meeting_link" placeholder="https://zoom.us/j/...">
                            <div class="field-help">Required for online and hybrid events</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="meeting_id">Meeting ID</label>
                            <input type="text" name="meeting_id" id="meeting_id" placeholder="Meeting ID">
                        </div>
                        <div class="form-group">
                            <label for="meeting_password">Meeting Password</label>
                            <input type="text" name="meeting_password" id="meeting_password" placeholder="Meeting password">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="prerequisites">Prerequisites</label>
                            <textarea name="prerequisites" id="prerequisites" placeholder="Any requirements or prerequisites for attendees"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="what_to_bring">What to Bring</label>
                            <textarea name="what_to_bring" id="what_to_bring" placeholder="Items participants should bring"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="dress_code">Dress Code</label>
                            <input type="text" name="dress_code" id="dress_code" placeholder="e.g. Business casual, Outdoor clothing">
                        </div>
                        <div class="form-group">
                            <label for="language">Primary Language</label>
                            <select name="language" id="language">
                                <option value="english">English</option>
                                <option value="spanish">Spanish</option>
                                <option value="french">French</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="accessibility_info">Accessibility Information</label>
                            <textarea name="accessibility_info" id="accessibility_info" placeholder="Wheelchair access, hearing loops, etc."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="parking_info">Parking Information</label>
                            <textarea name="parking_info" id="parking_info" placeholder="Parking availability and instructions"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Media & Content -->
                <div class="step-content" id="step-3">
                    <h2>Media & Visual Content</h2>
                    <p>Add images, videos, and rich content to make your event stand out.</p>
                    
                    <div class="form-group">
                        <label for="featured_image">Featured Image</label>
                        <div class="media-upload">
                            <input type="file" name="featured_image" id="featured_image" accept="image/*">
                            <p>Upload a high-quality featured image (recommended: 1200x600px)</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="image_gallery">Image Gallery</label>
                        <div class="media-upload">
                            <input type="file" name="image_gallery" id="image_gallery" accept="image/*" multiple>
                            <p>Upload additional images for the event gallery</p>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="video_url">Video URL</label>
                            <input type="url" name="video_url" id="video_url" placeholder="https://youtube.com/watch?v=...">
                        </div>
                        <div class="form-group">
                            <label for="video_file">Video Upload</label>
                            <input type="file" name="video_file" id="video_file" accept="video/*">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="event_banner">Event Banner/Header</label>
                        <div class="media-upload">
                            <input type="file" name="event_banner" id="event_banner" accept="image/*">
                            <p>Banner image for event headers (recommended: 1920x400px)</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="documents">Event Documents</label>
                        <div class="media-upload">
                            <input type="file" name="documents" id="documents" accept=".pdf,.doc,.docx" multiple>
                            <p>Upload PDFs, schedules, or other documents</p>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="event_agenda">Event Agenda/Schedule</label>
                            <textarea name="event_agenda" id="event_agenda" placeholder="Detailed schedule and agenda"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="speaker_info">Speaker/Presenter Information</label>
                            <textarea name="speaker_info" id="speaker_info" placeholder="Information about speakers, presenters, or instructors"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="rich_description">Rich Event Description</label>
                            <textarea name="rich_description" id="rich_description" placeholder="Detailed description with formatting, highlights, and additional information"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Ticketing & Pricing -->
                <div class="step-content" id="step-4">
                    <h2>Ticketing & Pricing</h2>
                    <p>Set up ticket types, pricing, and registration options.</p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="is_free" id="is_free" onchange="togglePricingFields()">
                                <label for="is_free">Free Event</label>
                            </div>
                            <div class="field-help">Check this if your event is completely free</div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="requires_registration" id="requires_registration" checked>
                                <label for="requires_registration">Requires Registration</label>
                            </div>
                            <div class="field-help">Even free events usually need registration</div>
                        </div>
                    </div>
                    
                    <div id="pricing-section">
                        <h3>Basic Pricing</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="cost">Event Cost (if single price)</label>
                                <input type="number" name="cost" id="cost" min="0" step="0.01" placeholder="0.00">
                                <div class="field-help">Set a single price for the event, or use ticket types below for multiple pricing options</div>
                            </div>
                                                         <div class="form-group">
                                 <label for="currency">Currency</label>
                                 <select name="currency" id="currency">
                                     <option value="NZD" selected>NZD ($)</option>
                                     <option value="AUD">AUD ($)</option>
                                     <option value="USD">USD ($)</option>
                                     <option value="EUR">EUR (€)</option>
                                     <option value="GBP">GBP (£)</option>
                                 </select>
                             </div>
                        </div>
                    </div>
                    
                    <div class="ticket-types">
                        <h3>Ticket Types</h3>
                        <div id="ticket-types-container">
                            <div class="ticket-type">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Ticket Name</label>
                                        <input type="text" name="ticket_name[]" placeholder="e.g. General Admission">
                                    </div>
                                    <div class="form-group">
                                        <label>Price</label>
                                        <input type="number" name="ticket_price[]" min="0" step="0.01" placeholder="0.00">
                                    </div>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Quantity Available</label>
                                        <input type="number" name="ticket_quantity[]" min="1" placeholder="Unlimited">
                                    </div>
                                    <div class="form-group">
                                        <label>Max per Person</label>
                                        <input type="number" name="ticket_max_per_person[]" min="1" placeholder="No limit">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Ticket Description</label>
                                    <textarea name="ticket_description[]" placeholder="Description of what this ticket includes"></textarea>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Sale Start Date</label>
                                        <input type="datetime-local" name="ticket_sale_start[]">
                                    </div>
                                    <div class="form-group">
                                        <label>Sale End Date</label>
                                        <input type="datetime-local" name="ticket_sale_end[]">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addTicketType()">Add Another Ticket Type</button>
                    </div>
                    
                    <div class="discount-group">
                        <h4>Optional Discounts</h4>
                        <div class="field-help">Leave blank if you don't want to offer discounts</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="early_bird_discount">Early Bird Discount (%)</label>
                                <input type="number" name="early_bird_discount" id="early_bird_discount" min="0" max="100" step="0.1" placeholder="Leave blank for no discount">
                                <div class="field-help">e.g. 10 for 10% off early registrations</div>
                            </div>
                            <div class="form-group">
                                <label for="group_discount">Group Discount (%)</label>
                                <input type="number" name="group_discount" id="group_discount" min="0" max="100" step="0.1" placeholder="Leave blank for no discount">
                                <div class="field-help">e.g. 15 for 15% off group bookings</div>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="member_discount">Member Discount (%)</label>
                                <input type="number" name="member_discount" id="member_discount" min="0" max="100" step="0.1" placeholder="Leave blank for no discount">
                                <div class="field-help">e.g. 20 for 20% off for members</div>
                            </div>
                            <div class="form-group">
                                <!-- Spacer for grid alignment -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="payment_methods">Accepted Payment Methods</label>
                            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                <div class="checkbox-group">
                                    <input type="checkbox" name="payment_methods[]" value="credit_card" id="payment_credit">
                                    <label for="payment_credit">Credit Card</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="payment_methods[]" value="paypal" id="payment_paypal">
                                    <label for="payment_paypal">PayPal</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="payment_methods[]" value="bank_transfer" id="payment_bank">
                                    <label for="payment_bank">Bank Transfer</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" name="payment_methods[]" value="cash" id="payment_cash">
                                    <label for="payment_cash">Cash</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="refund_policy">Refund Policy</label>
                            <textarea name="refund_policy" id="refund_policy" placeholder="Describe your refund and cancellation policy"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="registration_deadline">Registration Deadline</label>
                            <input type="datetime-local" name="registration_deadline" id="registration_deadline">
                        </div>
                    </div>
                </div>

                <!-- Step 5: External Links & Publishing -->
                <div class="step-content" id="step-5">
                    <h2>External Links & Publishing</h2>
                    <p>Connect your event to social media, partners, and publish settings.</p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="website_url">Event Website</label>
                            <input type="url" name="website_url" id="website_url" placeholder="https://yourwebsite.com">
                        </div>
                        <div class="form-group">
                            <label for="booking_url">External Booking URL</label>
                            <input type="url" name="booking_url" id="booking_url" placeholder="https://eventbrite.com/...">
                        </div>
                    </div>
                    
                    <h3>Social Media Links</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="facebook_url">Facebook Event</label>
                            <input type="url" name="facebook_url" id="facebook_url" placeholder="https://facebook.com/events/...">
                        </div>
                        <div class="form-group">
                            <label for="instagram_url">Instagram</label>
                            <input type="url" name="instagram_url" id="instagram_url" placeholder="https://instagram.com/...">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="twitter_url">Twitter/X</label>
                            <input type="url" name="twitter_url" id="twitter_url" placeholder="https://twitter.com/...">
                        </div>
                        <div class="form-group">
                            <label for="linkedin_url">LinkedIn</label>
                            <input type="url" name="linkedin_url" id="linkedin_url" placeholder="https://linkedin.com/...">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="youtube_url">YouTube</label>
                            <input type="url" name="youtube_url" id="youtube_url" placeholder="https://youtube.com/...">
                        </div>
                        <div class="form-group">
                            <label for="tiktok_url">TikTok</label>
                            <input type="url" name="tiktok_url" id="tiktok_url" placeholder="https://tiktok.com/...">
                        </div>
                    </div>
                    
                    <h3>Partner & Venue Links</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="venue_website">Venue Website</label>
                            <input type="url" name="venue_website" id="venue_website" placeholder="https://zoo.org">
                        </div>
                        <div class="form-group">
                            <label for="partner_url">Partner Organization</label>
                            <input type="url" name="partner_url" id="partner_url" placeholder="https://partner.org">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="related_events">Related Events (URLs)</label>
                            <textarea name="related_events" id="related_events" placeholder="Links to related or similar events (one per line)"></textarea>
                        </div>
                    </div>
                    
                    <h3>Contact Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="contact_name">Contact Name</label>
                            <input type="text" name="contact_name" id="contact_name" placeholder="Primary contact person">
                        </div>
                        <div class="form-group">
                            <label for="contact_email">Contact Email</label>
                            <input type="email" name="contact_email" id="contact_email" placeholder="contact@example.com">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="contact_phone">Contact Phone</label>
                            <input type="tel" name="contact_phone" id="contact_phone" placeholder="09 123 4567 or 021 123 456">
                        </div>
                        <div class="form-group">
                            <label for="emergency_contact">Emergency Contact</label>
                            <input type="tel" name="emergency_contact" id="emergency_contact" placeholder="09 123 4567 or 021 123 456">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="terms_url">Terms & Conditions URL</label>
                            <input type="url" name="terms_url" id="terms_url" placeholder="https://yoursite.com/terms">
                        </div>
                    </div>
                    
                    <div class="form-grid single">
                        <div class="form-group">
                            <label for="privacy_policy_url">Privacy Policy URL</label>
                            <input type="url" name="privacy_policy_url" id="privacy_policy_url" placeholder="https://yoursite.com/privacy">
                        </div>
                    </div>
                    
                    <h3>Publishing Settings</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="featured_event" id="featured_event">
                                <label for="featured_event">Featured Event</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="send_notifications" id="send_notifications">
                                <label for="send_notifications">Send Email Notifications</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="publish_date">Publish Date</label>
                            <input type="datetime-local" name="publish_date" id="publish_date">
                        </div>
                        <div class="form-group">
                            <label for="seo_keywords">SEO Keywords</label>
                            <input type="text" name="seo_keywords" id="seo_keywords" placeholder="event, education, kids, zoo">
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="wizard-actions">
                    <button type="button" class="btn btn-secondary" id="prev-btn" disabled>Previous</button>
                    <div>
                        <span id="step-info">Step 1 of 5</span>
                    </div>
                    <div id="next-section">
                        <button type="button" class="btn btn-primary" id="next-btn">Next</button>
                    </div>
                    <div id="submit-section" style="display: none;">
                        <div class="draft-help">Drafts can be completed and published later</div>
                        <div class="submit-buttons">
                            <button type="submit" name="save_as_draft" value="true" class="btn btn-secondary">Save as Draft</button>
                            <button type="submit" name="save_as_draft" value="false" class="btn btn-primary">Publish Event</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Preview Section -->
        <div class="preview-section">
            <h3>Live Preview</h3>
            <div class="event-preview" id="event-preview">
                <div class="preview-title">Event Title</div>
                <div class="preview-meta">Event details will appear here as you fill out the form</div>
            </div>
        </div>
    </div>
</div>

<script>
// Wizard functionality
let currentStep = 1;
const totalSteps = 5;

// Initialize wizard
document.addEventListener('DOMContentLoaded', function() {
    updateProgress();
    renderPreview();
    attachEventListeners();
});

// Navigation functions
function nextStep() {
    if (currentStep < totalSteps && validateCurrentStep()) {
        currentStep++;
        showStep(currentStep);
    }
}

function prevStep() {
    if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
    }
}

function showStep(step) {
    // Hide all steps
    document.querySelectorAll('.step-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Show current step
    document.getElementById(`step-${step}`).classList.add('active');
    
    // Update step indicators
    document.querySelectorAll('.step').forEach((stepEl, index) => {
        stepEl.classList.remove('active', 'completed');
        if (index + 1 === step) {
            stepEl.classList.add('active');
        } else if (index + 1 < step) {
            stepEl.classList.add('completed');
        }
    });
    
    // Update navigation buttons
    document.getElementById('prev-btn').disabled = step === 1;
    const nextSection = document.getElementById('next-section');
    const submitSection = document.getElementById('submit-section');
    
    if (step === totalSteps) {
        nextSection.style.display = 'none';
        submitSection.style.display = 'flex';
    } else {
        nextSection.style.display = 'block';
        submitSection.style.display = 'none';
    }
    
    // Update step info
    document.getElementById('step-info').textContent = `Step ${step} of ${totalSteps}`;
    
    updateProgress();
    renderPreview();
}

function updateProgress() {
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
}

function validateCurrentStep() {
    clearValidationErrors();
    
    const currentStepElement = document.getElementById(`step-${currentStep}`);
    const errors = [];
    
    // Step-specific validation
    switch(currentStep) {
        case 1:
            errors.push(...validateStep1());
            break;
        case 2:
            errors.push(...validateStep2());
            break;
        case 3:
            errors.push(...validateStep3());
            break;
        case 4:
            errors.push(...validateStep4());
            break;
        case 5:
            errors.push(...validateStep5());
            break;
    }
    
    if (errors.length > 0) {
        showValidationErrors(errors);
        return false;
    }
    
    return true;
}

function validateStep1() {
    const errors = [];
    
    // Required fields
    const title = document.getElementById('title').value.trim();
    const eventType = document.getElementById('event_type').value;
    const shortDesc = document.getElementById('short_description').value.trim();
    const startDate = document.getElementById('start_date').value;
    
    if (!title) {
        errors.push({ field: 'title', message: 'Event title is required' });
    }
    if (!eventType) {
        errors.push({ field: 'event_type', message: 'Please select an event type' });
    }
    if (!shortDesc) {
        errors.push({ field: 'short_description', message: 'Short description is required' });
    }
    if (!startDate) {
        errors.push({ field: 'start_date', message: 'Start date and time is required' });
    }
    
    // Validate end date if provided
    const endDate = document.getElementById('end_date').value;
    if (startDate && endDate && new Date(endDate) <= new Date(startDate)) {
        errors.push({ field: 'end_date', message: 'End date must be after start date' });
    }
    
    return errors;
}

function validateStep2() {
    const errors = [];
    
    // Required fields
    const eventFormat = document.getElementById('event_format').value;
    if (!eventFormat) {
        errors.push({ field: 'event_format', message: 'Please select an event format' });
    }
    
    // Age validation
    const minAge = document.getElementById('min_age').value;
    const maxAge = document.getElementById('max_age').value;
    
    if (minAge && maxAge && parseInt(maxAge) < parseInt(minAge)) {
        errors.push({ field: 'max_age', message: 'Maximum age must be greater than minimum age' });
    }
    
    // Format-specific validation
    if (eventFormat === 'online' || eventFormat === 'hybrid') {
        // Check for online meeting details if it's online/hybrid
        const meetingLink = document.getElementById('online_meeting_link').value.trim();
        if (!meetingLink) {
            errors.push({ field: 'online_meeting_link', message: 'Online meeting link is required for online/hybrid events' });
        } else if (!isValidUrl(meetingLink)) {
            errors.push({ field: 'online_meeting_link', message: 'Please enter a valid URL' });
        }
    }
    
    return errors;
}

function validateStep3() {
    const errors = [];
    // Step 3 is mostly optional, but we can validate file types
    
    const featuredImage = document.getElementById('featured_image').files[0];
    if (featuredImage && !featuredImage.type.startsWith('image/')) {
        errors.push({ field: 'featured_image', message: 'Please select a valid image file' });
    }
    
    const videoUrl = document.getElementById('video_url').value.trim();
    if (videoUrl && !isValidUrl(videoUrl)) {
        errors.push({ field: 'video_url', message: 'Please enter a valid video URL' });
    }
    
    return errors;
}

function validateStep4() {
    const errors = [];
    
    // Check if it's a free event
    const isFree = document.getElementById('is_free').checked;
    
    if (!isFree) {
        // If not free, check for at least one ticket type or cost
        const cost = document.getElementById('cost').value;
        const ticketPrices = document.querySelectorAll('input[name="ticket_price[]"]');
        
        let hasValidPricing = false;
        
        if (cost && parseFloat(cost) > 0) {
            hasValidPricing = true;
        }
        
        for (let priceInput of ticketPrices) {
            if (priceInput.value && parseFloat(priceInput.value) > 0) {
                hasValidPricing = true;
                break;
            }
        }
        
        if (!hasValidPricing) {
            errors.push({ field: 'cost', message: 'Please set a cost or add ticket pricing, or mark the event as free' });
        }
    }
    
    // Validate discount percentages
    const discountFields = ['early_bird_discount', 'group_discount', 'member_discount'];
    for (let fieldId of discountFields) {
        const value = document.getElementById(fieldId).value;
        if (value && (isNaN(parseFloat(value)) || parseFloat(value) < 0 || parseFloat(value) > 100)) {
            errors.push({ field: fieldId, message: 'Discount must be a number between 0 and 100' });
        }
    }
    
    return errors;
}

function validateStep5() {
    const errors = [];
    
    // Validate URLs if provided
    const urlFields = [
        'website_url', 'booking_url', 'facebook_url', 'instagram_url', 
        'twitter_url', 'linkedin_url', 'youtube_url', 'tiktok_url',
        'venue_website', 'partner_url', 'terms_url', 'privacy_policy_url'
    ];
    
    for (let fieldId of urlFields) {
        const element = document.getElementById(fieldId);
        if (element && element.value.trim() && !isValidUrl(element.value.trim())) {
            errors.push({ field: fieldId, message: 'Please enter a valid URL' });
        }
    }
    
    // Validate email
    const contactEmail = document.getElementById('contact_email').value.trim();
    if (contactEmail && !isValidEmail(contactEmail)) {
        errors.push({ field: 'contact_email', message: 'Please enter a valid email address' });
    }
    
    return errors;
}

function isValidUrl(string) {
    try {
        new URL(string);
        return true;
    } catch (_) {
        return false;
    }
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function showValidationErrors(errors) {
    // Create or update error message container
    let errorContainer = document.getElementById('validation-errors');
    if (!errorContainer) {
        errorContainer = document.createElement('div');
        errorContainer.id = 'validation-errors';
        errorContainer.className = 'validation-errors';
        
        const currentStepElement = document.getElementById(`step-${currentStep}`);
        currentStepElement.insertBefore(errorContainer, currentStepElement.firstChild);
    }
    
    // Build error message HTML
    const errorHtml = `
        <div class="error-header">
            <i class="error-icon">⚠️</i>
            <span>Please fix the following issues to continue:</span>
        </div>
        <ul class="error-list">
            ${errors.map(error => `<li>${error.message}</li>`).join('')}
        </ul>
    `;
    
    errorContainer.innerHTML = errorHtml;
    
    // Highlight error fields
    errors.forEach(error => {
        const field = document.getElementById(error.field);
        if (field) {
            field.classList.add('error-field');
            // Focus on first error field
            if (errors.indexOf(error) === 0) {
                field.focus();
                field.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
}

function clearValidationErrors() {
    // Remove error container
    const errorContainer = document.getElementById('validation-errors');
    if (errorContainer) {
        errorContainer.remove();
    }
    
    // Clear error field styling
    document.querySelectorAll('.error-field').forEach(field => {
        field.classList.remove('error-field');
    });
}

function renderPreview() {
    const title = document.getElementById('title').value || 'Event Title';
    const subtitle = document.getElementById('subtitle').value;
    const shortDesc = document.getElementById('short_description').value || 'Event description will appear here';
    const eventType = document.getElementById('event_type').value;
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    
    let meta = '';
    if (eventType) {
        meta += eventType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
    }
    if (startDate) {
        const date = new Date(startDate);
        meta += (meta ? ' • ' : '') + date.toLocaleDateString();
    }
    
    document.getElementById('event-preview').innerHTML = `
        <div class="preview-title">${title}</div>
        ${subtitle ? `<div class="preview-subtitle" style="font-size: 16px; color: #666; margin-bottom: 10px;">${subtitle}</div>` : ''}
        <div class="preview-meta">${meta}</div>
        <div class="preview-description" style="margin-top: 15px; line-height: 1.5;">${shortDesc}</div>
    `;
}

function attachEventListeners() {
    // Navigation buttons
    document.getElementById('next-btn').addEventListener('click', nextStep);
    document.getElementById('prev-btn').addEventListener('click', prevStep);
    
    // Form field listeners for live preview
    const previewFields = [
        'title', 'subtitle', 'short_description', 'event_type', 'start_date', 'end_date',
        'event_format', 'venue_name', 'address', 'city', 'max_participants', 'min_age', 'max_age',
        'featured_image', 'ticket_name[]', 'ticket_price[]', 'website_url', 'contact_name'
    ];
    
    previewFields.forEach(id => {
        const element = document.getElementById(id.replace('[]', ''));
        if (element) {
            element.addEventListener('input', renderPreview);
            element.addEventListener('change', renderPreview);
        }
    });
    
    // File upload listeners
    document.getElementById('featured_image').addEventListener('change', handleImagePreview);
}

// Enhanced live preview function
function renderPreview() {
    const title = document.getElementById('title').value || 'Event Title';
    const subtitle = document.getElementById('subtitle').value;
    const shortDesc = document.getElementById('short_description').value || 'Event description will appear here';
    const eventType = document.getElementById('event_type').value;
    const eventFormat = document.getElementById('event_format').value;
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    const venueName = document.getElementById('venue_name').value;
    const city = document.getElementById('city').value;
    const maxParticipants = document.getElementById('max_participants').value;
    const minAge = document.getElementById('min_age').value;
    const maxAge = document.getElementById('max_age').value;
    
    let meta = [];
    
    if (eventType) {
        meta.push(eventType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()));
    }
    
    if (eventFormat) {
        meta.push(eventFormat.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()));
    }
    
    if (startDate) {
        const date = new Date(startDate);
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit' 
        };
        meta.push(date.toLocaleDateString('en-US', options));
    }
    
    if (venueName || city) {
        const location = [venueName, city].filter(Boolean).join(', ');
        meta.push(location);
    }
    
    if (maxParticipants) {
        meta.push(`Max: ${maxParticipants} participants`);
    }
    
    if (minAge && maxAge) {
        meta.push(`Ages: ${minAge}–${maxAge}`);
    } else if (minAge) {
        meta.push(`Ages: ${minAge}+`);
    }
    
    // Get first ticket price if available
    const firstTicketPrice = document.querySelector('input[name="ticket_price[]"]');
    const ticketPrice = firstTicketPrice ? firstTicketPrice.value : '';
    
    let priceDisplay = '';
    if (ticketPrice && parseFloat(ticketPrice) > 0) {
        priceDisplay = `<div class="preview-price" style="font-size: 18px; font-weight: bold; color: #28a745; margin-top: 10px;">$${parseFloat(ticketPrice).toFixed(2)}</div>`;
    } else if (document.getElementById('is_free') && document.getElementById('is_free').checked) {
        priceDisplay = `<div class="preview-price" style="font-size: 18px; font-weight: bold; color: #28a745; margin-top: 10px;">FREE</div>`;
    }
    
    document.getElementById('event-preview').innerHTML = `
        <div class="preview-title">${title}</div>
        ${subtitle ? `<div class="preview-subtitle" style="font-size: 16px; color: #666; margin-bottom: 10px;">${subtitle}</div>` : ''}
        <div class="preview-meta" style="margin-bottom: 15px;">${meta.join(' • ')}</div>
        ${window.previewImageUrl ? `<img src="${window.previewImageUrl}" alt="Event preview" class="preview-image">` : ''}
        <div class="preview-description" style="line-height: 1.5;">${shortDesc}</div>
        ${priceDisplay}
    `;
}

// Handle image preview
function handleImagePreview(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            window.previewImageUrl = e.target.result;
            renderPreview();
        };
        reader.readAsDataURL(file);
    }
}

// Add ticket type functionality
function addTicketType() {
    const container = document.getElementById('ticket-types-container');
    const ticketTypeHtml = `
        <div class="ticket-type">
            <div class="form-grid">
                <div class="form-group">
                    <label>Ticket Name</label>
                    <input type="text" name="ticket_name[]" placeholder="e.g. VIP Access">
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" name="ticket_price[]" min="0" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Quantity Available</label>
                    <input type="number" name="ticket_quantity[]" min="1" placeholder="Unlimited">
                </div>
                <div class="form-group">
                    <label>Max per Person</label>
                    <input type="number" name="ticket_max_per_person[]" min="1" placeholder="No limit">
                </div>
            </div>
            <div class="form-group">
                <label>Ticket Description</label>
                <textarea name="ticket_description[]" placeholder="Description of what this ticket includes"></textarea>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Sale Start Date</label>
                    <input type="datetime-local" name="ticket_sale_start[]">
                </div>
                <div class="form-group">
                    <label>Sale End Date</label>
                    <input type="datetime-local" name="ticket_sale_end[]">
                </div>
            </div>
            <button type="button" class="btn btn-secondary" onclick="removeTicketType(this)" style="margin-top: 10px;">Remove Ticket Type</button>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', ticketTypeHtml);
    
    // Add event listeners to new fields
    const newTicketType = container.lastElementChild;
    const priceInput = newTicketType.querySelector('input[name="ticket_price[]"]');
    if (priceInput) {
        priceInput.addEventListener('input', renderPreview);
    }
}

function removeTicketType(button) {
    const ticketType = button.closest('.ticket-type');
    ticketType.remove();
    renderPreview();
}

// Toggle pricing fields based on free event checkbox
function togglePricingFields() {
    const isFree = document.getElementById('is_free').checked;
    const pricingSection = document.getElementById('pricing-section');
    const ticketTypes = document.querySelector('.ticket-types');
    const discountGroup = document.querySelector('.discount-group');
    
    if (isFree) {
        pricingSection.style.display = 'none';
        ticketTypes.style.display = 'none';
        discountGroup.style.display = 'none';
    } else {
        pricingSection.style.display = 'block';
        ticketTypes.style.display = 'block';
        discountGroup.style.display = 'block';
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    attachEventListeners();
    renderPreview();
    showStep(1);
    togglePricingFields(); // Initialize pricing field visibility
});
</script>
{% endblock %} 